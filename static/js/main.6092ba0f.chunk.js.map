{"version":3,"sources":["fs.js","api/game.worker.js","../node_modules/peerjs/dist sync","serviceWorker.js","api/sound.js","api/load_spawn.js","api/webrtc.js","api/loader.js","App.js","index.js"],"names":["importStorage","Promise","resolve","reject","done","frame","document","createElement","window","addEventListener","_ref","data","method","files","contentWindow","postMessage","src","style","display","body","appendChild","setTimeout","downloadFile","_callee","store","name","file","blob","url","lnk","_Users_jirischwarz_GitHub_diabloweb_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default","a","wrap","_context","prev","next","get","toLowerCase","sent","Blob","type","URL","createObjectURL","setAttribute","click","removeChild","revokeObjectURL","console","error","concat","stop","downloadSaves","_callee2","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","_context2","undefined","keys","t0","Symbol","iterator","value","match","t1","return","finish","readFile","reader","FileReader","onload","result","onerror","onabort","readAsArrayBuffer","uploadFile","_callee3","_context3","Uint8Array","set","abrupt","create_fs","_x7","_create_fs","apply","this","arguments","_callee4","load","_i","_Object$entries","_ref7","_ref3","_name","_data","_files","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_ref6","_ref5","_context4","IdbKvStore","Map","Object","json","entries","call","length","_Users_jirischwarz_GitHub_diabloweb_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","t2","DownloadFile","DownloadSaves","update","delete","remove","clear","download","upload","t3","module","exports","Worker","__webpack_require__","p","webpackEmptyContext","req","e","Error","code","id","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","log","onUpdate","onSuccess","catch","init_sound","AudioContext","webkitAudioContext","StereoPannerNode","create_sound","duplicate_sound","play_sound","set_volume","stop_sound","delete_sound","context","sounds","create_sound_raw","channels","rate","buffer","createBuffer","i","getChannelData","subarray","gain","createGain","panner","pan","decodeAudioData","srcId","volume","loop","source","Math","pow","relVolume","createBufferSource","node","connect","destination","start","stop_all","sound","slicedToArray","err","SpawnSizes","load_spawn","_x","_x2","_load_spawn","api","fs","spawn","regenerator_default","includes","byteLength","axios","request","process","responseType","onDownloadProgress","onProgress","text","loaded","total","headers","Cache-Control","slice","buffer_reader","classCallCheck","pos","read8","String","fromCharCode","toConsumableArray","buffer_writer","write8","charCodeAt","RejectionReason","JOIN_SUCCESS","JOIN_ALREADY_IN_GAME","JOIN_GAME_NOT_FOUND","JOIN_INCORRECT_PASSWORD","JOIN_VERSION_MISMATCH","JOIN_GAME_FULL","CREATE_GAME_EXISTS","server_packet","info","read","version","read32","write","write32","game_list","count","games","push","read_str","_ref2","writer","reduce","sum","write_str","join_accept","cookie","index","seed","difficulty","join_reject","reason","_ref8","disconnect","_ref9","message","payload","rest","_ref10","turn","_ref11","client_packet","_ref12","create_game","password","_ref13","join_game","_ref14","leave_game","drop_player","_ref15","_ref16","_ref17","PeerID","webrtc_server","_ref18","onMessage","onClose","_this","peer","Peer","on","conn","onConnect","players","myplr","floor","random","onError","off","onOpen","_this2","packet","pkt","send","handle","drop","mask","destroy","close","webrtc_client","_ref19","_this3","pending","needUnreg","unreg","clearTimeout","timeout","webrtc_open","server","client","onRender","ctx","bitmap","images","clip","belt","transferFromImageBitmap","x","y","w","h","image","createImageData","putImageData","save","font","x0","y0","x1","y1","beginPath","rect","_ref4","str","color","r","g","b","fillStyle","fillText","restore","updateBelt","audio","mpq","offscreen","canvas","getContext","alpha","worker","packetQueue","webrtc","action","func","_len","params","Array","_key","batch","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","setCursorPos","openKeyboard","stack","onExit","setCurrentSave","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","transfer","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","setInterval","load_game","do_load_game","reportLink","retail","searchParams","split","map","line","join","userAgent","toString","ReactGA","initialize","pageview","TOUCH_MOVE","TOUCH_RMB","keyboardRule","styleSheets","sheet","cssRules","rule","CSSRule","MEDIA_RULE","conditionText","sub","selectorText","findKeyboardRule","Link","children","props","objectWithoutProperties","react_default","assign","target","rel","App","possibleConstructorReturn","getPrototypeOf","started","loading","dropping","has_spawn","cursorPos","touchControls","touchButtons","touchCtx","touchMods","touchBelt","maxKeyboard","onDrop","dataTransfer","items","kind","getAsFile","getDropFile","preventDefault","setState","onDragEnter","setDropping","onDragOver","isDropFile","onDragLeave","downloadSave","saveName","stopPropagation","onResize","exitPointerLock","onPointerLockChange","screen","innerHeight","height","pointerLocked","game","onMouseMove","_this$mousePos","mousePos","eventMods","onMouseDown","keyboard","element","classList","_this$mousePos2","requestPointerLock","mouseButton","onMouseUp","_this$mousePos3","onKeyDown","keyCode","showKeyboard","key","clearKeySel","onMenu","onKeyUp","onKeyboard","onKeyboardInner","onKeyboardBlur","parseFile","touchButton","touchCanvas","onTouchStart","blur","updateTouchButton","touches","_this$mousePos4","onTouchMove","_this$mousePos5","onTouchEnd","prevTc","_this$mousePos6","setTouchMod","fullscreenElement","requestFullscreen","setCanvas","setElement","setKeyboard","setTouch0","setTouch_","bind","assertThisInitialized","setTouch1","setTouch2","setTouch3","setTouchBelt_","setTouch4","setTouch5","inc","max","left","toFixed","top","width","add","focus","transform","keyboardNum","getBoundingClientRect","right","bottom","progress","reload","idx","slot","drawImage","used","Set","has","drawBelt","_this4","removeEventListener","event","category","passive","capture","pointerLockElement","mozPointerLockElement","min","movementX","movementY","clientX","clientY","round","button","shiftKey","ctrlKey","altKey","len","setSelectionRange","flags","valid","substring","maxValue","parseInt","use","toggle","now","performance","beltTime","release","_this5","touchOther","btn","_loop","identifier","stick","find","t","panPos","v","indexOf","original","_ret","dx","dy","step","offsetHeight","abs","_this6","_this$state","className","classNames","touch","ref","active","onChange","onBlur","spellCheck","App_Link","href","onClick","htmlFor","accept","React","Component","ReactDOM","render","src_App_0","getElementById","origin","fetch","response","contentType","status","ready","unregister","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.6092ba0f.chunk.js","sourcesContent":["import IdbKvStore from  'idb-kv-store';\n\nconst importStorage = () => new Promise((resolve, reject) => {\n  let done = false;\n  const frame = document.createElement('iframe');\n  window.addEventListener('message', ({data}) => {\n    if (data.method === 'storage' && !done) {\n      done = true;\n      resolve(data.files);\n      frame.contentWindow.postMessage({method: 'clear'}, '*');\n    }\n  });\n  frame.addEventListener('load', () => {\n    frame.contentWindow.postMessage({method: 'transfer'}, '*');\n  });\n  frame.addEventListener('error', () => {\n    if (!done) {\n      done = true;\n      resolve(null);\n    }\n  });\n  frame.src = \"https://diablo.rivsoft.net/storage.html\";\n  frame.style.display = \"none\";\n  document.body.appendChild(frame);\n  setTimeout(() => {\n    if (!done) {\n      done = true;\n      resolve(null);\n    }\n  }, 10000);\n});\n\nasync function downloadFile(store, name) {\n  const file = await store.get(name.toLowerCase());\n  if (file) {\n    const blob = new Blob([file], {type: 'binary/octet-stream'});\n    const url = URL.createObjectURL(blob);\n    const lnk = document.createElement('a');\n    lnk.setAttribute('href', url);\n    lnk.setAttribute('download', name);\n    document.body.appendChild(lnk);\n    lnk.click();\n    document.body.removeChild(lnk);\n    URL.revokeObjectURL(url);\n  } else {\n    console.error(`File ${name} does not exist`);\n  }\n}\n\nasync function downloadSaves(store) {\n  for (let name of await store.keys()) {\n    if (name.match(/\\.sv$/i)) {\n      downloadFile(store, name);\n    }\n  }\n}\n\nconst readFile = file => new Promise((resolve, reject) => {\n  const reader = new FileReader();\n  reader.onload = () => resolve(reader.result);\n  reader.onerror = () => reject(reader.error);\n  reader.onabort = () => reject();\n  reader.readAsArrayBuffer(file);\n});\nasync function uploadFile(store, files, file) {\n  const data = new Uint8Array(await readFile(file));\n  files.set(file.name.toLowerCase(), data);\n  return store.set(file.name.toLowerCase(), data);\n}\n\nexport default async function create_fs(load) {\n  try {\n    const store = new IdbKvStore('diablo_fs');\n    const files = new Map();\n    for (let [name, data] of Object.entries(await store.json())) {\n      files.set(name, data);\n    }\n    if (load) {\n      const files = await importStorage();\n      if (files) {\n        for (let [name, data] of files) {\n          files.set(name, data);\n          store.set(name, data);\n        }\n      }\n    }\n    window.DownloadFile = name => downloadFile(store, name);\n    window.DownloadSaves = () => downloadSaves(store);\n    return {\n      files,\n      update: (name, data) => store.set(name, data),\n      delete: name => store.remove(name),\n      clear: () => store.clear(),\n      download: name => downloadFile(store, name),\n      upload: file => uploadFile(store, files, file),\n    };\n  } catch (e) {\n    window.DownloadFile = () => console.error('IndexedDB is not supported');\n    window.DownloadSaves = () => console.error('IndexedDB is not supported');\n    return {\n      files: new Map(),\n      update: () => Promise.resolve(),\n      delete: () => Promise.resolve(),\n      clear: () => Promise.resolve(),\n      download: () => Promise.resolve(),\n      upload: () => Promise.resolve(),\n    };\n  }  \n}\n","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"06c7bc513d67cd48c316.worker.js\");\n};","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 62;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","function no_sound() {\n  return {\n    create_sound: () => 0,\n    duplicate_sound: () => 0,\n    play_sound: () => undefined,\n    set_volume: () => undefined,\n    stop_sound: () => undefined,\n    delete_sound: () => undefined,\n  };\n}\n\nfunction decodeAudioData(context, buffer) {\n  return new Promise((resolve, reject) => {\n    context.decodeAudioData(buffer, resolve, reject);\n  });\n}\n\nexport default function init_sound() {\n  const AudioContext = window.AudioContext || window.webkitAudioContext;\n  const StereoPannerNode = window.StereoPannerNode;\n  if (!AudioContext) {\n    return no_sound();\n  }\n\n  let context = null;\n  try {\n    context = new AudioContext();\n  } catch (e) {\n  }\n  const sounds = new Map();\n\n  return {\n    create_sound_raw(id, data, length, channels, rate) {\n      if (!context) {\n        return;\n      }\n      const buffer = context.createBuffer(channels, length, rate);\n      for (let i = 0; i < channels; ++i) {\n        buffer.getChannelData(i).set(data.subarray(i * length, i * length + length));\n      }\n      sounds.set(id, {\n        buffer: Promise.resolve(buffer),\n        gain: context.createGain(),\n        panner: StereoPannerNode && new StereoPannerNode(context, {pan: 0}),\n      });\n    },\n    create_sound(id, data) {\n      if (!context) {\n        return;\n      }\n      const buffer = decodeAudioData(context, data.buffer);\n      sounds.set(id, {\n        buffer,\n        gain: context.createGain(),\n        panner: StereoPannerNode && new StereoPannerNode(context, {pan: 0}),\n      });\n    },\n    duplicate_sound(id, srcId) {\n      if (!context) {\n        return;\n      }\n      const src = sounds.get(srcId);\n      if (!src) {\n        return;\n      }\n      sounds.set(id, {\n        buffer: src.buffer,\n        gain: context.createGain(),\n        panner: StereoPannerNode && new StereoPannerNode(context, {pan: 0}),\n      });\n    },\n    play_sound(id, volume, pan, loop) {\n      const src = sounds.get(id);\n      if (src) {\n        if (src.source) {\n          src.source.then(source => source.stop());\n        }\n        src.gain.gain.value = Math.pow(2.0, volume / 1000.0);\n        const relVolume = Math.pow(2.0, pan / 1000.0);\n        if (src.panner) {\n          src.panner.pan.value = 1.0 - 2.0 / (1.0 + relVolume);\n        }\n        src.source = src.buffer.then(buffer => {\n          const source = context.createBufferSource();\n          source.buffer = buffer;\n          source.loop = !!loop;\n          let node = source.connect(src.gain);\n          if (src.panner) {\n            node = node.connect(src.panner);\n          }\n          node.connect(context.destination);\n          source.start();\n          return source;\n        });\n      }\n    },\n    set_volume(id, volume) {\n      const src = sounds.get(id);\n      if (src) {\n        src.gain.gain.value = Math.pow(2.0, volume / 1000.0);\n      }\n    },\n    stop_sound(id) {\n      const src = sounds.get(id);\n      if (src && src.source) {\n        src.source.then(source => source.stop());\n        delete src.source;\n      }\n    },\n    delete_sound(id) {\n      const src = sounds.get(id);\n      if (src && src.source) {\n        src.source.then(source => source.stop());\n      }\n      sounds.delete(id);\n    },\n\n    stop_all() {\n      for (let [, sound] of sounds) {\n        if (sound.source) {\n          sound.source.then(source => source.stop());\n        }\n      }\n      sounds.clear();\n      context = null;\n    }\n  };\n}\n","import axios from 'axios';\n\nconst SpawnSizes = [50274091, 25830791];\n\nexport { SpawnSizes };\n\nexport default async function load_spawn(api, fs) {\n  let file = fs.files.get('spawn.mpq');\n  if (file && !SpawnSizes.includes(file.byteLength)) {\n    fs.files.delete('spawn.mpq');\n    await fs.delete('spawn.mpq');\n    file = null;\n  }\n  if (!file) {\n    const spawn = await axios.request({\n      url: process.env.PUBLIC_URL + '/spawn.mpq',\n      responseType: 'arraybuffer',\n      onDownloadProgress: e => {\n        if (api.onProgress) {\n          api.onProgress({text: 'Downloading...', loaded: e.loaded, total: e.total || SpawnSizes[1]});\n        }\n      },\n      headers: {\n        'Cache-Control': 'max-age=31536000'\n      }\n    });\n    if (!SpawnSizes.includes(spawn.data.byteLength)) {\n      throw Error(\"Invalid spawn.mpq size. Try clearing cache and refreshing the page.\");\n    }\n    const data = new Uint8Array(spawn.data);\n    fs.files.set('spawn.mpq', data);\n    fs.update('spawn.mpq', data.slice());\n  }\n  return fs;\n}\n","import Peer from 'peerjs';\n\nclass buffer_reader {\n  constructor(buffer) {\n    this.buffer = (buffer instanceof Uint8Array ? buffer : new Uint8Array(buffer));\n    this.pos = 0;\n  }\n  done() {\n    return this.pos === this.buffer.byteLength;\n  }\n  read8() {\n    if (this.pos >= this.buffer.byteLength) {\n      throw Error('packet too small');\n    }\n    return this.buffer[this.pos++];\n  }\n  read16() {\n    const {pos, buffer} = this;\n    if (pos + 2 > buffer.byteLength) {\n      throw Error('packet too small');\n    }\n    const result = buffer[pos] | (buffer[pos + 1] << 8);\n    this.pos += 2;\n    return result;\n  }\n  read32() {\n    const {pos, buffer} = this;\n    if (pos + 4 > buffer.byteLength) {\n      throw Error('packet too small');\n    }\n    const result = buffer[pos] | (buffer[pos + 1] << 8) | (buffer[pos + 2] << 16) | (buffer[pos + 3] << 24);\n    this.pos += 4;\n    return result;\n  }\n  read_str() {\n    const length = this.read8();\n    const {pos, buffer} = this;\n    if (pos + length > buffer.byteLength) {\n      throw Error('packet too small');\n    }\n    const result = String.fromCharCode(...buffer.subarray(pos, pos + length));\n    this.pos += length;\n    return result;\n  }\n  rest() {\n    const result = this.buffer.subarray(this.pos);\n    this.pos = this.buffer.length;\n    return result;\n  }\n}\nclass buffer_writer {\n  constructor(length) {\n    this.buffer = new Uint8Array(length);\n    this.pos = 0;\n  }\n  get result() {\n    return this.buffer.buffer;\n  }\n  write8(value) {\n    this.buffer[this.pos++] = value;\n    return this;\n  }\n  write16(value) {\n    const {pos, buffer} = this;\n    buffer[pos] = value;\n    buffer[pos + 1] = value >> 8;\n    this.pos += 2;\n    return this;\n  }\n  write32(value) {\n    const {pos, buffer} = this;\n    buffer[pos] = value;\n    buffer[pos + 1] = value >> 8;\n    buffer[pos + 2] = value >> 16;\n    buffer[pos + 3] = value >> 24;\n    this.pos += 4;\n    return this;\n  }\n  write_str(value) {\n    const length = value.length;\n    this.write8(length);\n    const {pos, buffer} = this;\n    for (let i = 0; i < length; ++i) {\n      buffer[pos + i] = value.charCodeAt(i);\n    }\n    this.pos += length;\n    return this;\n  }\n  rest(value) {\n    this.buffer.set(value, this.pos);\n    return this;\n  }\n}\n\nconst RejectionReason = {\n  JOIN_SUCCESS: 0x00,\n  JOIN_ALREADY_IN_GAME: 0x01,\n  JOIN_GAME_NOT_FOUND: 0x02,\n  JOIN_INCORRECT_PASSWORD: 0x03,\n  JOIN_VERSION_MISMATCH: 0x04,\n  JOIN_GAME_FULL: 0x05,\n  CREATE_GAME_EXISTS: 0x06,\n};\n\nconst server_packet = {\n  info: {\n    code: 0x32,\n    read: reader => ({version: reader.read32()}),\n    write: ({version}) => new buffer_writer(5).write8(server_packet.info.code).write32(version).result,\n  },\n  game_list: {\n    code: 0x21,\n    read: reader => {\n      const count = reader.read8();\n      const games = [];\n      for (let i = 0; i < count; ++i) {\n        games.push({type: reader.read32(), name: reader.read_str()});\n      }\n      return {games};\n    },\n    write: ({games}) => {\n      const writer = new buffer_writer(games.reduce((sum, {name}) => sum + 5 + name.length, 2));\n      writer.write8(server_packet.game_list.code);\n      writer.write8(games.length);\n      for (let {code, name} of games) {\n        writer.write32(code);\n        writer.write_str(name);\n      }\n      return writer.result;\n    },\n  },\n  join_accept: {\n    code: 0x12,\n    read: reader => ({cookie: reader.read32(), index: reader.read8(), seed: reader.read32(), difficulty: reader.read32()}),\n    write: ({cookie, index, seed, difficulty}) => new buffer_writer(14).write8(server_packet.join_accept.code).write32(cookie).write8(index).write32(seed).write32(difficulty).result,\n  },\n  join_reject: {\n    code: 0x15,\n    read: reader => ({cookie: reader.read32(), reason: reader.read8()}),\n    write: ({cookie, reason}) => new buffer_writer(6).write8(server_packet.join_reject.code).write32(cookie).write8(reason).result,\n  },\n  connect: {\n    code: 0x13,\n    read: reader => ({id: reader.read8()}),\n    write: ({id}) => new buffer_writer(2).write8(server_packet.connect.code).write8(id).result,\n  },\n  disconnect: {\n    code: 0x14,\n    read: reader => ({id: reader.read8(), reason: reader.read32()}),\n    write: ({id, reason}) => new buffer_writer(6).write8(server_packet.disconnect.code).write8(id).write32(reason).result,\n  },\n  message: {\n    code: 0x01,\n    read: reader => ({id: reader.read8(), payload: reader.rest()}),\n    write: ({id, payload}) => new buffer_writer(2 + payload.byteLength).write8(server_packet.message.code).write8(id).rest(payload).result,\n  },\n  turn: {\n    code: 0x02,\n    read: reader => ({id: reader.read8(), turn: reader.read32()}),\n    write: ({id, turn}) => new buffer_writer(6).write8(server_packet.turn.code).write8(id).write32(turn).result,\n  },\n};\n\nconst client_packet = {\n  info: {\n    code: 0x31,\n    read: reader => ({version: reader.read32()}),\n    write: ({version}) => new buffer_writer(5).write8(client_packet.info.code).write32(version).result,\n  },\n  game_list: {\n    code: 0x21,\n    read: () => ({}),\n    write: () => new buffer_writer(1).write8(client_packet.game_list.code).result,\n  },\n  create_game: {\n    code: 0x22,\n    read: reader => ({cookie: reader.read32(), name: reader.read_str(), password: reader.read_str(), difficulty: reader.read32()}),\n    write: ({cookie, name, password, difficulty}) => new buffer_writer(11 + name.length + password.length)\n      .write8(client_packet.create_game.code).write32(cookie).write_str(name).write_str(password).write32(difficulty).result,\n  },\n  join_game: {\n    code: 0x23,\n    read: reader => ({cookie: reader.read32(), name: reader.read_str(), password: reader.read_str()}),\n    write: ({cookie, name, password}) => new buffer_writer(7 + name.length + password.length)\n      .write8(client_packet.join_game.code).write32(cookie).write_str(name).write_str(password).result,\n  },\n  leave_game: {\n    code: 0x24,\n    read: () => ({}),\n    write: () => new buffer_writer(1).write8(client_packet.leave_game.code).result,\n  },\n  drop_player: {\n    code: 0x03,\n    read: reader => ({id: reader.read8(), reason: reader.read32()}),\n    write: ({id, reason}) => new buffer_writer(6).write8(client_packet.drop_player.code).write8(id).write32(reason).result,\n  },\n  message: {\n    code: 0x01,\n    read: reader => ({id: reader.read8(), payload: reader.rest()}),\n    write: ({id, payload}) => new buffer_writer(2 + payload.byteLength).write8(client_packet.message.code).write8(id).rest(payload).result,\n  },\n  turn: {\n    code: 0x02,\n    read: reader => ({turn: reader.read32()}),\n    write: ({turn}) => new buffer_writer(5).write8(client_packet.turn.code).write32(turn).result,\n  },\n};\n\n/*function log_packet(data, type) {\n  const reader = new buffer_reader(data);\n  const id = reader.read8();\n  for (let [name, {code, read}] of Object.entries(type)) {\n    if (code === id && (name !== 'message' && name !== 'turn')) {\n      console.log(`${type === client_packet ? 'client_packet' : 'server_packet'}.${name} ${JSON.stringify(read(reader))}`);\n    }\n  }\n}*/\n\nconst PeerID = name => `diabloweb_${name}`;\nconst MAX_PLRS = 4;\n\nclass webrtc_server {\n  constructor(version, {cookie, name, password, difficulty}, onMessage, onClose) {\n    this.version = version;\n    this.name = name;\n    this.password = password;\n    this.difficulty = difficulty;\n    this.onMessage = onMessage;\n    this.onClose = onClose;\n\n    this.peer = new Peer(PeerID(name));\n    this.peer.on('connection', conn => this.onConnect(conn));\n    this.players = [];\n    this.myplr = 0;\n\n    this.seed = Math.floor(Math.random() * Math.pow(2, 32));\n\n    const onError = () => {\n      onMessage(server_packet.join_reject.write({cookie, reason: RejectionReason.CREATE_GAME_EXISTS}));\n      onClose();\n      this.peer.off('error', onError);\n      this.peer.off('open', onOpen);\n    };\n    const onOpen = () => {\n      //console.log('peer open');\n      setTimeout(() => {\n        onMessage(server_packet.join_accept.write({cookie, index: 0, seed: this.seed, difficulty}));\n        onMessage(server_packet.connect.write({id: 0}));\n      }, 0);\n      this.peer.off('error', onError);\n      this.peer.off('open', onOpen);\n    };\n    this.peer.on('error', onError);\n    this.peer.on('open', onOpen);\n\n    //this.peer.on('error', err => console.log('peer error:', err));\n  }\n\n  onConnect(conn) {\n    //conn.on('error', err => console.log('conn error:', err));\n    //console.log('conn open');\n    const peer = {conn};\n    conn.on('data', packet => {\n      const reader = new buffer_reader(packet);\n      const code = reader.read8();\n      let pkt;\n      switch (code) {\n      case client_packet.info.code:\n        pkt = client_packet.info.read(reader);\n        peer.version = pkt.version;\n        break;\n      case client_packet.join_game.code:\n        pkt = client_packet.join_game.read(reader);\n        if (peer.version !== this.version) {\n          conn.send(server_packet.join_reject.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_VERSION_MISMATCH}));\n        } else if (pkt.name !== this.name) {\n          conn.send(server_packet.join_reject.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_GAME_NOT_FOUND}));\n        } else if (pkt.password !== this.password) {\n          conn.send(server_packet.join_reject.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_INCORRECT_PASSWORD}));\n        } else {\n          let i = 1;\n          while (i < MAX_PLRS && this.players[i]) {\n            ++i;\n          }\n          if (i >= MAX_PLRS) {\n            conn.send(server_packet.join_reject.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_GAME_FULL}));            \n          } else {\n            this.players[i] = peer;\n            peer.id = i;\n            conn.send(server_packet.join_accept.write({cookie: pkt.cookie, index: i, seed: this.seed, difficulty: this.difficulty}));\n            this.send(0xFF, server_packet.connect.write({id: i}));\n          }\n        }\n        break;\n      default:\n        if (peer.id != null) {\n          this.handle(peer.id, code, reader);\n        } else {\n          return;\n        }\n      }\n      if (!reader.done()) {\n        throw Error('packet too large');\n      }\n    });\n    conn.on('close', () => {\n      //console.log('conn close');\n      if (peer.id != null) {\n        this.drop(peer.id, 0x40000006);\n      }\n    });\n  }\n\n  send(mask, pkt) {\n    for (let i = 1; i < MAX_PLRS; ++i) {\n      if ((mask & (1 << i)) && this.players[i]) {\n        if (this.players[i].conn) {\n          this.players[i].conn.send(pkt);\n        }\n      }\n    }\n    // self last since it will destroy the buffer\n    if (mask & 1) {\n      this.onMessage(pkt);\n    }\n  }\n\n  drop(id, reason) {\n    if (id === 0) {\n      for (let i = 1; i < MAX_PLRS; ++i) {\n        this.drop(i, 0x40000006);\n      }\n      this.onMessage(server_packet.disconnect.write({id, reason}));\n      this.peer.destroy();\n      this.onClose();\n    } else if (this.players[id]) {\n      this.send(0xFF, server_packet.disconnect.write({id, reason}));\n      this.players[id].id = null;\n      if (this.players[id].conn) {\n        this.players[id].conn.close();\n      }\n      this.players[id] = null;\n    }\n  }\n\n  handle(id, code, reader) {\n    let pkt;\n    switch (code) {\n    case client_packet.leave_game.code:\n      pkt = client_packet.leave_game.read(reader);\n      this.drop(id, 3);\n      break;\n    case client_packet.drop_player.code:\n      pkt = client_packet.drop_player.read(reader);\n      this.drop(pkt.id, pkt.reason);\n      break;\n    case client_packet.message.code:\n      pkt = client_packet.message.read(reader);\n      this.send(pkt.id === 0xFF ? ~(1 << id) : (1 << pkt.id), server_packet.message.write({id, payload: pkt.payload}));\n      break;\n    case client_packet.turn.code:\n      pkt = client_packet.turn.read(reader);\n      this.send(~(1 << id), server_packet.turn.write({id, turn: pkt.turn}));\n      break;\n    default:\n      throw Error(`invalid packet ${code}`);\n    }\n  }\n}\n\nclass webrtc_client {\n  pending = [];\n\n  constructor(version, {cookie, name, password}, onMessage, onClose) {\n    this.peer = new Peer();\n    this.conn = this.peer.connect(PeerID(name));\n\n    let needUnreg = true;\n    const unreg = () => {\n      if (!needUnreg) {\n        return;\n      }\n      needUnreg = false;\n      this.peer.off('error', onError);\n      this.conn.off('error', onError);\n      this.conn.off('open', onOpen);\n      clearTimeout(timeout);\n    };\n    const onError = () => {\n      onMessage(server_packet.join_reject.write({cookie, reason: RejectionReason.JOIN_GAME_NOT_FOUND}));\n      onClose();\n      unreg();\n    };\n    const onOpen = () => {\n      this.conn.send(client_packet.info.write({version}));\n      this.conn.send(client_packet.join_game.write({cookie, name, password}));\n      for (let pkt of this.pending) {\n        this.conn.send(pkt);\n      }\n      this.pending = null;\n      this.conn.off('open', onOpen);\n    };\n    const timeout = setTimeout(onError, 10000);\n    this.peer.on('error', onError);\n    this.conn.on('error', onError);\n    this.conn.on('open', onOpen);\n\n    //this.peer.on('error', err => console.log('peer error:', err));\n    //this.conn.on('error', err => console.log('conn error:', err));\n\n    this.conn.on('data', data => {\n      unreg();\n      const reader = new buffer_reader(data);\n      const code = reader.read8();\n      let pkt;\n      switch (code) {\n      case server_packet.join_accept.code:\n        pkt = server_packet.join_accept.read(reader);\n        this.myplr = pkt.index;\n        break;\n      case server_packet.join_reject.code:\n        onClose();\n        break;\n      case server_packet.disconnect.code:\n        pkt = server_packet.disconnect.read(reader);\n        if (pkt.id === 'myplr') {\n          onClose();\n        }\n        break;\n      default:\n      }\n      onMessage(data);\n    });\n    this.conn.on('close', data => {\n      onClose();\n    });\n  }\n\n  send(packet) {\n    if (this.pending) {\n      this.pending.push(packet);\n    } else {\n      this.conn.send(packet);\n    }\n  }\n}\n\nexport default function webrtc_open(onMessage) {\n  let server = null, client = null;\n\n  let version = 0;\n\n  /*const prevMessage = onMessage;\n  onMessage = data => {\n    log_packet(data, server_packet);\n    prevMessage(data);\n  };*/\n\n  return {\n    send: function(packet) {\n      //log_packet(packet, client_packet);\n      const reader = new buffer_reader(packet);\n      const code = reader.read8();\n      let pkt;\n      switch (code) {\n      case client_packet.info.code:\n        pkt = client_packet.info.read(reader);\n        version = pkt.version;\n        break;\n      case client_packet.create_game.code:\n        pkt = client_packet.create_game.read(reader);\n        if (server || client) {\n          onMessage(server_packet.join_reject.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_ALREADY_IN_GAME}));\n        } else {\n          server = new webrtc_server(version, pkt, onMessage, () => server = null);\n        }\n        break;\n      case client_packet.join_game.code:\n        pkt = client_packet.join_game.read(reader);\n        if (server || client) {\n          onMessage(server_packet.join_reject.write({cookie: pkt.cookie, reason: RejectionReason.JOIN_ALREADY_IN_GAME}));\n        } else {\n          client = new webrtc_client(version, pkt, onMessage, () => client = null);\n        }\n        break;\n      default:\n        if (server) {\n          server.handle(0, code, reader);\n          if (code === client_packet.leave_game.code) {\n            server = null;\n          }\n        } else if (client) {\n          client.send(packet);\n          if (code === client_packet.leave_game.code) {\n            client = null;\n          }\n          return;\n        } else if (code !== client_packet.leave_game.code) {\n          throw Error(`invalid packet ${code}`);\n        }\n      }\n      if (!reader.done()) {\n        throw Error('packet too large');\n      }\n    },\n  };\n}\n","import Worker from './game.worker.js';\nimport init_sound from './sound';\nimport load_spawn from './load_spawn';\nimport webrtc_open from './webrtc';\n\nfunction onRender(api, ctx, {bitmap, images, text, clip, belt}) {\n  if (bitmap) {\n    ctx.transferFromImageBitmap(bitmap);\n  } else {\n    for (let {x, y, w, h, data} of images) {\n      const image = ctx.createImageData(w, h);\n      image.data.set(data);\n      ctx.putImageData(image, x, y);\n    }\n    if (text.length) {\n      ctx.save();\n      ctx.font = 'bold 13px Times New Roman';\n      if (clip) {\n        const {x0, y0, x1, y1} = clip;\n        ctx.beginPath();\n        ctx.rect(x0, y0, x1 - x0, y1 - y0);\n        ctx.clip();\n      }\n      for (let {x, y, text: str, color} of text) {\n        const r = ((color >> 16) & 0xFF);\n        const g = ((color >> 8) & 0xFF);\n        const b = (color & 0xFF);\n        ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;\n        ctx.fillText(str, x, y + 22);\n      }\n      ctx.restore();\n    }\n  }\n\n  api.updateBelt(belt);\n}\n\nfunction testOffscreen() {\n  return false;\n  // This works but I couldn't see any performance difference, and support for 2D canvas in workers is very poor.\n  // In this mode, instead of sending a batch of areas to draw back to the main thread, the worker does all drawing on its own and sends a complete bitmap object back.\n  // However, this effectively clears the worker's canvas, so we need to redraw the whole frame every time, which defeats the performance gained from reduced copying.\n  /*try {\n    const canvas = document.createElement(\"canvas\");\n    const offscreen = canvas.transferControlToOffscreen();\n    const context = offscreen.getContext(\"2d\");\n    return context != null;\n  } catch (e) {\n    return false;\n  }*/\n}\n\nasync function do_load_game(api, audio, mpq, spawn) {\n  const fs = await api.fs;\n  if (spawn && !mpq) {\n    await load_spawn(api, fs);\n  }\n\n  let context = null, offscreen = false;\n  if (testOffscreen()) {\n    context = api.canvas.getContext(\"bitmaprenderer\");\n    offscreen = true;\n  } else {\n    context = api.canvas.getContext(\"2d\", {alpha: false});\n  }\n  return await new Promise((resolve, reject) => {\n    try {\n      const worker = new Worker();\n\n      let packetQueue = [];\n      const webrtc = webrtc_open(data => {\n        packetQueue.push(data);\n      });\n\n      worker.addEventListener(\"message\", ({data}) => {\n        switch (data.action) {\n        case \"loaded\":\n          resolve((func, ...params) => worker.postMessage({action: \"event\", func, params}));\n          break;\n        case \"render\":\n          onRender(api, context, data.batch);\n          break;\n        case \"audio\":\n          audio[data.func](...data.params);\n          break;\n        case \"audioBatch\":\n          for (let {func, params} of data.batch) {\n            audio[func](...params);\n          }\n          break;\n        case \"fs\":\n          fs[data.func](...data.params);\n          break;\n        case \"cursor\":\n          api.setCursorPos(data.x, data.y);\n          break;\n        case \"keyboard\":\n          api.openKeyboard(data.rect);\n          break;\n        case \"error\":\n          audio.stop_all();\n          api.onError(data.error, data.stack);\n          break;\n        case \"failed\":\n          reject(Error(data.stack || data.error));\n          break;\n        case \"progress\":\n          api.onProgress({text: data.text, loaded: data.loaded, total: data.total});\n          break;\n        case \"exit\":\n          api.onExit();\n          break;\n        case \"current_save\":\n          api.setCurrentSave(data.name);\n          break;\n          case \"packet\":\n          webrtc.send(data.buffer);\n          break;\n        case \"packetBatch\":\n          for (let packet of data.batch) {\n            webrtc.send(packet);\n          }\n          break;\n        default:\n        }\n      });          \n      const transfer= [];\n      for (let [, file] of fs.files) {\n        transfer.push(file.buffer);\n      }\n      worker.postMessage({action: \"init\", files: fs.files, mpq, spawn, offscreen}, transfer);\n      setInterval(() => {\n        if (packetQueue.length) {\n          worker.postMessage({action: \"packetBatch\", batch: packetQueue}, packetQueue);\n          packetQueue.length = 0;\n        }\n      }, 20);\n      delete fs.files;\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n\nexport default function load_game(api, mpq, spawn) {\n  const audio = init_sound();\n  return do_load_game(api, audio, mpq, spawn);\n}\n","import React from 'react';\nimport './App.scss';\nimport classNames from 'classnames';\nimport ReactGA from 'react-ga';\n\nimport create_fs from './fs';\nimport load_game from './api/loader';\nimport { SpawnSizes } from './api/load_spawn';\n\nimport Peer from 'peerjs';\n\nwindow.Peer = Peer;\n\nif (process.env.NODE_ENV === 'production') {\n  ReactGA.initialize('UA-43123589-6');\n  ReactGA.pageview('/');\n}\n\nfunction reportLink(e, retail) {\n  const message = e.stack || e.message || \"Unknown error\";\n  const url = new URL(\"https://github.com/d07RiV/diabloweb/issues/new\");\n  url.searchParams.set(\"body\",\n`**Description:**\n[Please describe what you were doing before the error occurred]\n\n**App version:**\nDiabloWeb ${process.env.VERSION} (${retail ? 'Retail' : 'Shareware'})\n\n**Error message:**\n    \n${message.split(\"\\n\").map(line => \"    \" + line).join(\"\\n\")}\n\n**User agent:**\n\n    ${navigator.userAgent}\n\n**Save file:**\n[Please attach the save file, if applicable. The error box should have a link to download the current save you were playing; alternatively, you can open dev console on the game page (F12) and type in ${\"`DownloadSaves()`\"}]\n`);\n  return url.toString();\n}\n\nfunction isDropFile(e) {\n  if (e.dataTransfer.items) {\n    for (let i = 0; i < e.dataTransfer.items.length; ++i) {\n      if (e.dataTransfer.items[i].kind === \"file\") {\n        return true;\n      }\n    }\n  } if (e.dataTransfer.files.length) {\n    return true;\n  }\n  return false;\n}\nfunction getDropFile(e) {\n  if (e.dataTransfer.items) {\n    for (let i = 0; i < e.dataTransfer.items.length; ++i) {\n      if (e.dataTransfer.items[i].kind === \"file\") {\n        return e.dataTransfer.items[i].getAsFile();\n      }\n    }\n  } if (e.dataTransfer.files.length) {\n    return e.dataTransfer.files[0];\n  }\n}\n\nconst TOUCH_MOVE = 0;\nconst TOUCH_RMB = 1;\nconst TOUCH_SHIFT = 2;\n\nfunction findKeyboardRule() {\n  for (let sheet of document.styleSheets) {\n    for (let rule of sheet.cssRules) {\n      if (rule.type === CSSRule.MEDIA_RULE && rule.conditionText === '(min-aspect-ratio: 3/1)') {\n        for (let sub of rule.cssRules) {\n          if (sub.selectorText === '.App.keyboard .Body .inner') {\n            return sub;\n          }\n        }\n      }\n    }\n  }\n}\nlet keyboardRule = null;\ntry {\n  keyboardRule = findKeyboardRule();\n} catch (e) {\n}\n\nconst Link = ({children, ...props}) => <a target=\"_blank\" rel=\"noopener noreferrer\" {...props}>{children}</a>;\n\nclass App extends React.Component {\n  files = new Map();\n  state = {started: false, loading: false, dropping: 0, has_spawn: false};\n  cursorPos = {x: 0, y: 0};\n\n  touchControls = false;\n  touchButtons = [null, null, null, null, null, null];\n  touchCtx = [null, null, null, null, null, null];\n  touchMods = [false, false, false, false, false, false];\n  touchBelt = [-1, -1, -1, -1, -1, -1];\n  maxKeyboard = 0;\n\n  fs = create_fs(true);\n\n  constructor(props) {\n    super(props);\n\n    this.setTouch0 = this.setTouch_.bind(this, 0);\n    this.setTouch1 = this.setTouch_.bind(this, 1);\n    this.setTouch2 = this.setTouch_.bind(this, 2);\n    this.setTouch3 = this.setTouchBelt_.bind(this, 3);\n    this.setTouch4 = this.setTouchBelt_.bind(this, 4);\n    this.setTouch5 = this.setTouchBelt_.bind(this, 5);\n  }\n\n  componentDidMount() {\n    document.addEventListener(\"drop\", this.onDrop, true);\n    document.addEventListener(\"dragover\", this.onDragOver, true);\n    document.addEventListener(\"dragenter\", this.onDragEnter, true);\n    document.addEventListener(\"dragleave\", this.onDragLeave, true);\n\n    this.fs.then(fs => {\n      const spawn = fs.files.get('spawn.mpq');\n      if (spawn && SpawnSizes.includes(spawn.byteLength)) {\n        this.setState({has_spawn: true});\n      }\n    });\n  }\n\n  onDrop = e => {\n    const file = getDropFile(e);\n    if (file) {\n      e.preventDefault();\n      this.start(file);\n    }\n    this.setState({dropping: 0});\n  }\n  onDragEnter = e => {\n    e.preventDefault();\n    this.setDropping(1);\n  }\n  onDragOver = e => {\n    if (isDropFile(e)) {\n      e.preventDefault();\n    }\n  }\n  onDragLeave = e => {\n    this.setDropping(-1);\n  }\n  setDropping(inc) {\n    this.setState(({dropping}) => ({dropping: Math.max(dropping + inc, 0)}));\n  }\n\n  onError(message, stack) {\n    this.setState(({error}) => !error && {error: {message, stack}});\n  }\n\n  openKeyboard(rect) {\n    if (rect) {\n      this.showKeyboard = {\n        left: `${(100 * (rect[0] - 10) / 640).toFixed(2)}%`,\n        top: `${(100 * (rect[1] - 10) / 480).toFixed(2)}%`,\n        width: `${(100 * (rect[2] - rect[0] + 20) / 640).toFixed(2)}%`,\n        height: `${(100 * (rect[3] - rect[1] + 20) / 640).toFixed(2)}%`,\n      };\n      this.maxKeyboard = rect[4];\n      this.element.classList.add(\"keyboard\");\n      Object.assign(this.keyboard.style, this.showKeyboard);\n      this.keyboard.focus();\n      if (keyboardRule) {\n        keyboardRule.style.transform = `translate(-50%, ${(-(rect[1] + rect[3]) * 56.25 / 960).toFixed(2)}vw)`;\n      }\n    } else {\n      this.showKeyboard = false;\n      this.element.classList.remove(\"keyboard\");\n      this.keyboard.blur();\n      this.keyboard.value = \"\";\n      this.keyboardNum = 0;\n    }\n  }\n\n  setCursorPos(x, y) {\n    const rect = this.canvas.getBoundingClientRect();\n    this.cursorPos = {\n      x: rect.left + (rect.right - rect.left) * x / 640,\n      y: rect.top + (rect.bottom - rect.top) * y / 480,\n    };\n    setTimeout(() => {\n      this.game(\"DApi_Mouse\", 0, 0, 0, x, y);\n    });\n  }\n\n  onProgress(progress) {\n    this.setState({progress});\n  }\n\n  onExit() {\n    if (!this.state.error) {\n      window.location.reload();\n    }\n  }\n\n  setCurrentSave(name) {\n    this.saveName = name;\n  }\n  downloadSave = e => {\n    this.fs.then(fs => this.saveName && fs.download(this.saveName));\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  drawBelt(idx, slot) {\n    if (!this.canvas) return;\n    if (!this.touchButtons[idx]) {\n      return;\n    }\n    this.touchBelt[idx] = slot;\n    if (slot >= 0) {\n      this.touchButtons[idx].style.display = \"block\";\n      this.touchCtx[idx].drawImage(this.canvas, 205 + 29 * slot, 357, 28, 28, 0, 0, 28, 28);\n    } else {\n      this.touchButtons[idx].style.display = \"none\";\n    }\n  }\n\n  updateBelt(belt) {\n    if (belt) {\n      const used = new Set();\n      let pos = 3;\n      for (let i = 0; i < belt.length && pos < 6; ++i) {\n        if (belt[i] >= 0 && !used.has(belt[i])) {\n          this.drawBelt(pos++, i);\n          used.add(belt[i]);\n        }\n      }\n      for (; pos < 6; ++pos) {\n        this.drawBelt(pos, -1);\n      }\n    } else {\n      this.drawBelt(3, -1);\n      this.drawBelt(4, -1);\n      this.drawBelt(5, -1);\n    }\n  }\n\n  start(file) {\n    if (file && file.name.match(/\\.sv$/i)) {\n      this.fs.then(fs => fs.upload(file)).then(console.log(`Updated ${file.name}`));\n      return;\n    }\n\n    document.removeEventListener(\"drop\", this.onDrop, true);\n    document.removeEventListener(\"dragover\", this.onDragOver, true);\n    document.removeEventListener(\"dragenter\", this.onDragEnter, true);\n    document.removeEventListener(\"dragleave\", this.onDragLeave, true);\n    this.setState({dropping: 0});\n\n    const retail = !!(file && file.name.match(/^diabdat\\.mpq$/i));\n    if (process.env.NODE_ENV === 'production') {\n      ReactGA.event({\n        category: 'Game',\n        action: retail ? 'Start Retail' : 'Start Shareware',\n      });\n    }\n\n    this.setState({loading: true, retail});\n\n    load_game(this, file, !retail).then(game => {\n      this.game = game;\n\n      document.addEventListener('mousemove', this.onMouseMove, true);\n      document.addEventListener('mousedown', this.onMouseDown, true);\n      document.addEventListener('mouseup', this.onMouseUp, true);\n      document.addEventListener('keydown', this.onKeyDown, true);\n      document.addEventListener('keyup', this.onKeyUp, true);\n      document.addEventListener('contextmenu', this.onMenu, true);\n\n      document.addEventListener('touchstart', this.onTouchStart, {passive: false, capture: true});\n      document.addEventListener('touchmove', this.onTouchMove, {passive: false, capture: true});\n      document.addEventListener('touchend', this.onTouchEnd, {passive: false, capture: true});\n\n      document.addEventListener('pointerlockchange', this.onPointerLockChange);\n      window.addEventListener('resize', this.onResize);\n\n      this.setState({started: true});\n    }, e => this.onError(e.message, e.stack));\n  }\n\n  pointerLocked() {\n    return document.pointerLockElement === this.canvas || document.mozPointerLockElement === this.canvas;\n  }\n\n  mousePos(e) {\n    const rect = this.canvas.getBoundingClientRect();\n    if (this.pointerLocked()) {\n      this.cursorPos.x = Math.max(rect.left, Math.min(rect.right, this.cursorPos.x + e.movementX));\n      this.cursorPos.y = Math.max(rect.top, Math.min(rect.bottom, this.cursorPos.y + e.movementY));\n    } else {\n      this.cursorPos = {x: e.clientX, y: e.clientY};\n    }\n    return {\n      x: Math.max(0, Math.min(Math.round((this.cursorPos.x - rect.left) / (rect.right - rect.left) * 640), 639)),\n      y: Math.max(0, Math.min(Math.round((this.cursorPos.y - rect.top) / (rect.bottom - rect.top) * 480), 479)),\n    };\n  }\n\n  mouseButton(e) {\n    switch (e.button) {\n    case 0: return 1;\n    case 1: return 4;\n    case 2: return 2;\n    case 3: return 5;\n    case 4: return 6;\n    default: return 1;\n    }\n  }\n  eventMods(e) {\n    return ((e.shiftKey || this.touchMods[TOUCH_SHIFT]) ? 1 : 0) + (e.ctrlKey ? 2 : 0) + (e.altKey ? 4 : 0) + (e.touches ? 8 : 0);\n  }\n\n  onResize = () => {\n    document.exitPointerLock();\n  }\n\n  onPointerLockChange = () => {\n    if (window.screen && window.innerHeight === window.screen.height && !this.pointerLocked()) {\n      // assume that the user pressed escape\n      this.game(\"DApi_Key\", 0, 0, 27);\n      this.game(\"DApi_Key\", 1, 0, 27);\n    }\n  }\n\n  onMouseMove = e => {\n    if (!this.canvas) return;\n    const {x, y} = this.mousePos(e);\n    this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\n    e.preventDefault();\n  }\n\n  onMouseDown = e => {\n    if (!this.canvas) return;\n    if (e.target === this.keyboard) {\n      return;\n    }\n    if (this.touchControls) {\n      this.touchControls = false;\n      this.element.classList.remove(\"touch\");\n    }\n    const {x, y} = this.mousePos(e);\n    if (window.screen && window.innerHeight === window.screen.height) {\n      // we're in fullscreen, let's get pointer lock!\n      if (!this.pointerLocked()) {\n        this.canvas.requestPointerLock();\n      }\n    }\n    this.game(\"DApi_Mouse\", 1, this.mouseButton(e), this.eventMods(e), x, y);\n    e.preventDefault();\n  }\n\n  onMouseUp = e => {\n    if (!this.canvas) return;\n    if (e.target === this.keyboard) {\n      //return;\n    }\n    const {x, y} = this.mousePos(e);\n    this.game(\"DApi_Mouse\", 2, this.mouseButton(e), this.eventMods(e), x, y);\n    if (e.target !== this.keyboard) {\n      e.preventDefault();\n    }\n  }\n\n  onKeyDown = e => {\n    if (!this.canvas) return;\n    this.game(\"DApi_Key\", 0, this.eventMods(e), e.keyCode);\n    if (!this.showKeyboard && (e.keyCode >= 32 && e.key.length === 1)) {\n      this.game(\"DApi_Char\", e.key.charCodeAt(0));\n    } else if (e.keyCode === 8 || e.keyCode === 13) {\n      this.game(\"DApi_Char\", e.keyCode);\n    }\n    this.clearKeySel();\n    if (!this.showKeyboard) {\n      if (e.keyCode === 8 || e.keyCode === 9 || (e.keyCode >= 112 && e.keyCode <= 119)) {\n        e.preventDefault();\n      }\n    }\n  }\n\n  onMenu = e => {\n    e.preventDefault();\n  }\n\n  onKeyUp = e => {\n    if (!this.canvas) return;\n    this.game(\"DApi_Key\", 1, this.eventMods(e), e.keyCode);\n    this.clearKeySel();\n  }\n\n  clearKeySel() {\n    if (this.showKeyboard) {\n      const len = this.keyboard.value.length;\n      this.keyboard.setSelectionRange(len, len);\n    }\n  }\n\n  onKeyboardInner(flags) {\n    if (this.showKeyboard) {\n      const text = this.keyboard.value;\n      let valid;\n      if (this.maxKeyboard > 0) {\n        valid = (text.match(/[\\x20-\\x7E]/g) || []).join(\"\").substring(0, this.maxKeyboard);\n      } else {\n        const maxValue = -this.maxKeyboard;\n        if (text.match(/^\\d*$/)) {\n          this.keyboardNum = Math.min(text.length ? parseInt(text) : 0, maxValue);\n        }\n        valid = (this.keyboardNum ? this.keyboardNum.toString() : \"\");\n      }\n      if (text !== valid) {\n        this.keyboard.value = valid;\n      }\n      this.clearKeySel();\n      this.game(\"text\", valid, flags);\n    }\n  }\n  onKeyboard = () => {\n    this.onKeyboardInner(0);\n  }\n  onKeyboardBlur = () => {\n    this.onKeyboardInner(1);\n  }\n\n  parseFile = e => {\n    const files = e.target.files;\n    if (files.length > 0) {\n      this.start(files[0]);\n    }\n  }\n\n  touchButton = null;\n  touchCanvas = null;\n\n  setTouchMod(index, value, use) {\n    if (index < 3) {\n      this.touchMods[index] = value;\n      if (this.touchButtons[index]) {\n        this.touchButtons[index].classList.toggle(\"active\", value);\n      }\n    } else if (use && this.touchBelt[index] >= 0) {\n      const now = performance.now();\n      if (!this.beltTime || now - this.beltTime > 750) {\n        this.game(\"DApi_Char\", 49 + this.touchBelt[index]);\n        this.beltTime = now;\n      }\n    }\n  }\n\n  updateTouchButton(touches, release) {\n    let touchOther = null;\n    if (!this.touchControls) {\n      this.touchControls = true;\n      this.element.classList.add(\"touch\");\n    }\n    const btn = this.touchButton;\n    for (let {target, identifier, clientX, clientY} of touches) {\n      if (btn && btn.id === identifier && this.touchButtons[btn.index] === target) {\n        if (touches.length > 1) {\n          btn.stick = false;\n        }\n        btn.clientX = clientX;\n        btn.clientY = clientY;\n        this.touchCanvas = [...touches].find(t => t.identifier !== identifier);\n        if (this.touchCanvas) {\n          this.touchCanvas = {clientX: this.touchCanvas.clientX, clientY: this.touchCanvas.clientY};\n        }\n        delete this.panPos;\n        return this.touchCanvas != null;\n      }\n      const idx = this.touchButtons.indexOf(target);\n      if (idx >= 0 && !touchOther) {\n        touchOther = {id: identifier, index: idx, stick: true, original: this.touchMods[idx], clientX, clientY};\n      }\n    }\n    if (btn && !touchOther && release && btn.stick) {\n      const rect = this.touchButtons[btn.index].getBoundingClientRect();\n      const {clientX, clientY} = btn;\n      if (clientX >= rect.left && clientX < rect.right && clientY >= rect.top && clientY < rect.bottom) {\n        this.setTouchMod(btn.index, !btn.original, true);\n      } else {\n        this.setTouchMod(btn.index, btn.original);\n      }\n    } else if (btn) {\n      this.setTouchMod(btn.index, false);\n    }\n    this.touchButton = touchOther;\n    if (touchOther) {\n      this.setTouchMod(touchOther.index, true);\n      if (touchOther.index === TOUCH_MOVE) {\n        this.setTouchMod(TOUCH_RMB, false);\n      } else if (touchOther.index === TOUCH_RMB) {\n        this.setTouchMod(TOUCH_MOVE, false);\n      }\n      delete this.panPos;\n    } else if (touches.length === 2) {\n      const x = (touches[1].clientX + touches[0].clientX) / 2, y = (touches[1].clientY + touches[0].clientY) / 2;\n      if (this.panPos) {\n        const dx = x - this.panPos.x, dy = y - this.panPos.y;\n        const step = this.canvas.offsetHeight / 12;\n        if (Math.max(Math.abs(dx), Math.abs(dy)) > step) {\n          let key;\n          if (Math.abs(dx) > Math.abs(dy)) {\n            key = (dx > 0 ? 0x25 : 0x27);\n          } else {\n            key = (dy > 0 ? 0x26 : 0x28);\n          }\n          this.game(\"DApi_Key\", 0, 0, key);\n          // key up is ignored anyway\n          this.panPos = {x, y};\n        }\n      } else {\n        this.game(\"DApi_Mouse\", 0, 0, 24, 320, 180);\n        this.game(\"DApi_Mouse\", 2, 1, 24, 320, 180);\n        this.panPos = {x, y};\n      }\n      this.touchCanvas = null;\n      return false;\n    } else {\n      delete this.panPos;\n    }\n    this.touchCanvas = [...touches].find(t => !touchOther || t.identifier !== touchOther.id);\n    if (this.touchCanvas) {\n      this.touchCanvas = {clientX: this.touchCanvas.clientX, clientY: this.touchCanvas.clientY};\n    }\n    return this.touchCanvas != null;\n  }\n\n  onTouchStart = e => {\n    if (!this.canvas) return;\n    if (e.target === this.keyboard) {\n      return;\n    } else {\n      this.keyboard.blur();\n    }\n    e.preventDefault();\n    if (this.updateTouchButton(e.touches, false)) {\n      const {x, y} = this.mousePos(this.touchCanvas);\n      this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\n      if (!this.touchMods[TOUCH_MOVE]) {\n        this.game(\"DApi_Mouse\", 1, this.touchMods[TOUCH_RMB] ? 2 : 1, this.eventMods(e), x, y);\n      }\n    }\n  }\n  onTouchMove = e => {\n    if (!this.canvas) return;\n    if (e.target === this.keyboard) {\n      return;\n    }\n    e.preventDefault();\n    if (this.updateTouchButton(e.touches, false)) {\n      const {x, y} = this.mousePos(this.touchCanvas);\n      this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\n    }\n  }\n  onTouchEnd = e => {\n    if (!this.canvas) return;\n    if (e.target === this.keyboard) {\n      //return;\n    } else {\n      e.preventDefault();\n    }\n    const prevTc = this.touchCanvas;\n    this.updateTouchButton(e.touches, true);\n    if (prevTc && !this.touchCanvas) {\n      const {x, y} = this.mousePos(prevTc);\n      this.game(\"DApi_Mouse\", 2, 1, this.eventMods(e), x, y);\n      this.game(\"DApi_Mouse\", 2, 2, this.eventMods(e), x, y);\n\n      if (this.touchMods[TOUCH_RMB] && (!this.touchButton || this.touchButton.index !== TOUCH_RMB)) {\n        this.setTouchMod(TOUCH_RMB, false);\n      }\n    }\n    if (!document.fullscreenElement) {\n      this.element.requestFullscreen();\n    }\n  }\n\n  setCanvas = e => this.canvas = e;\n  setElement = e => this.element = e;\n  setKeyboard = e => this.keyboard = e;\n  setTouch_(i, e) {\n    this.touchButtons[i] = e;\n  }\n  setTouchBelt_(i, e) {\n    this.touchButtons[i] = e;\n    if (e) {\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = 28;\n      canvas.height = 28;\n      e.appendChild(canvas);\n      this.touchCtx[i] = canvas.getContext(\"2d\");\n    } else {\n      this.touchCtx[i] = null;\n    }\n  }\n\n  render() {\n    const {started, loading, error, progress, dropping, has_spawn} = this.state;\n    return (\n      <div className={classNames(\"App\", {touch: this.touchControls, started, dropping, keyboard: !!this.showKeyboard})} ref={this.setElement}>\n        <div className=\"touch-ui touch-mods\">\n          <div className={classNames(\"touch-button\", \"touch-button-0\", {active: this.touchMods[0]})} ref={this.setTouch0}/>\n          <div className={classNames(\"touch-button\", \"touch-button-1\", {active: this.touchMods[1]})} ref={this.setTouch1}/>\n          <div className={classNames(\"touch-button\", \"touch-button-2\", {active: this.touchMods[2]})} ref={this.setTouch2}/>\n        </div>\n        <div className=\"touch-ui touch-belt\">\n          <div className={classNames(\"touch-button\", \"touch-button-0\")} ref={this.setTouch3}/>\n          <div className={classNames(\"touch-button\", \"touch-button-1\")} ref={this.setTouch4}/>\n          <div className={classNames(\"touch-button\", \"touch-button-2\")} ref={this.setTouch5}/>\n        </div>\n        <div className=\"Body\">\n          <div className=\"inner\">\n            {!error && <canvas ref={this.setCanvas} width={640} height={480}/>}\n            <input type=\"text\" className=\"keyboard\" onChange={this.onKeyboard} onBlur={this.onKeyboardBlur} ref={this.setKeyboard} spellCheck={false} style={this.showKeyboard || {}}/>\n          </div>\n        </div>\n        <div className=\"BodyV\">\n          {!!error && (\n            <Link className=\"error\" href={reportLink(error, this.state.retail)}>\n              <p className=\"header\">The following error has occurred:</p>\n              <p className=\"body\">{error.message}</p>\n              <p className=\"footer\">Click to create an issue on GitHub</p>\n              {this.saveName != null && <p className=\"link\" onClick={this.downloadSave}>Download save file</p>}\n            </Link>\n          )}\n          {!!loading && !started && !error && (\n            <div className=\"loading\">\n              {(progress && progress.text) || 'Loading...'}\n              {progress != null && !!progress.total && (\n                <span className=\"progressBar\"><span><span style={{width: `${Math.round(100 * progress.loaded / progress.total)}%`}}/></span></span>\n              )}\n            </div>\n          )}\n          {!started && !loading && !error && (\n            <div className=\"start\">\n              <p>\n                This is a web port of the original Diablo game, based on source code reconstructed by\n                GalaXyHaXz and devilution team. The project page with information and links can be found over here <Link href=\"https://github.com/d07RiV/diabloweb\">https://github.com/d07RiV/diabloweb</Link>\n              </p>\n              <p>\n                If you own the original game, you can drop the original DIABDAT.MPQ onto this page or click the button below to start playing.\n                The game can be purchased from <Link href=\"https://www.gog.com/game/diablo\">GoG</Link>.\n              </p>\n              {!has_spawn && (\n                <p>\n                  Or you can play the shareware version for free (50MB download).\n                </p>\n              )}\n              <form>\n                <label htmlFor=\"loadFile\" className=\"startButton\">Select MPQ</label>\n                <input accept=\".mpq\" type=\"file\" id=\"loadFile\" style={{display: \"none\"}} onChange={this.parseFile}/>\n              </form>\n              <span className=\"startButton\" onClick={() => this.start()}>Play Shareware</span>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './reset.css';\nimport * as serviceWorker from './serviceWorker';\n\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\nserviceWorker.register({\n  onUpdate() {\n  },\n});\n"],"sourceRoot":""}